# JSON Diff ツール 要件定義書

## 1. プロジェクト概要

### 1.1 目的
JSON形式のデータを比較し、差分を視覚的かつ構造的に表示するリッチなツールを提供する。

### 1.2 背景
- API開発時のレスポンス比較
- 設定ファイルのバージョン間差分確認
- データ移行時の検証
- デバッグ作業の効率化

## 2. 機能要件

### 2.1 コア機能

#### FR-001: JSON入力
- 左右2つのパネルでJSON入力を受け付ける
- テキスト直接入力
- ファイルドラッグ&ドロップ
- URLからのフェッチ（Workerで処理）
- クリップボードからのペースト

#### FR-002: JSON検証
- リアルタイムJSON構文検証
- エラー位置のハイライト表示
- エラーメッセージの日本語/英語対応
- 自動フォーマット（整形）機能

#### FR-003: 差分検出
- 追加された要素の検出
- 削除された要素の検出
- 変更された値の検出
- 配列要素の移動検出
- ネストされたオブジェクトの差分検出

#### FR-004: 差分表示
- Side-by-Side表示（左右並列）
- Unified表示（統合差分）
- Inline表示（インライン差分）
- 折りたたみ可能なツリービュー
- 差分のみ表示モード

#### FR-005: ナビゲーション
- 差分箇所へのジャンプ機能
- 前の差分/次の差分への移動
- 行番号クリックでのジャンプ
- パスによる検索・ジャンプ

### 2.2 高度な機能

#### FR-006: セマンティック差分
- 配列の順序無視オプション
- 特定キーをIDとして扱う配列比較
- 浮動小数点の許容誤差設定
- null/undefined/空文字列の等価性設定

#### FR-007: フィルタリング
- 特定パスの除外
- 正規表現によるキーフィルタ
- 差分タイプ別フィルタ（追加/削除/変更）
- 値の型別フィルタ

#### FR-008: エクスポート
- 差分レポートのJSON出力
- Markdown形式での出力
- HTML形式での出力
- JSONパッチ (RFC 6902) 形式での出力

#### FR-009: 履歴管理
- 比較履歴の保存（ローカルストレージ）
- 履歴からの復元
- お気に入り保存

#### FR-010: 共有機能
- 比較結果のURL共有（Workerでデータ保存）
- 短縮URL生成

## 3. 非機能要件

### 3.1 パフォーマンス
- NFR-001: 1MB以下のJSONファイルは2秒以内に差分表示
- NFR-002: 仮想スクロールによる大規模データ対応
- NFR-003: Web Worker を使用した非同期処理

### 3.2 ユーザビリティ
- NFR-004: ダークモード/ライトモード対応
- NFR-005: キーボードショートカット対応
- NFR-006: レスポンシブデザイン
- NFR-007: アクセシビリティ（WCAG 2.1 AA準拠）

### 3.3 信頼性
- NFR-008: オフライン動作対応（PWA）
- NFR-009: 入力データのローカル処理（プライバシー保護）

### 3.4 保守性
- NFR-010: ドメイン駆動設計による責務分離
- NFR-011: 関数型プログラミングによる副作用管理
- NFR-012: 依存性逆転による疎結合設計

## 4. ユースケース

### UC-001: 基本的なJSON比較
```
アクター: ユーザー
前提条件: ツールにアクセスしている
基本フロー:
1. 左パネルにJSON Aを入力
2. 右パネルにJSON Bを入力
3. システムが自動的に差分を検出
4. 差分が視覚的にハイライト表示される
5. ユーザーが差分を確認する
```

### UC-002: 配列のセマンティック比較
```
アクター: ユーザー
前提条件: 比較対象のJSONに配列が含まれる
基本フロー:
1. 設定で「配列の順序を無視」を有効化
2. 配列要素のIDキーを指定
3. システムがID基準で配列要素をマッチング
4. 要素の順序変更ではなく、内容の差分のみ表示
```

### UC-003: 差分レポートのエクスポート
```
アクター: ユーザー
前提条件: 差分が検出されている
基本フロー:
1. エクスポートボタンをクリック
2. 出力形式を選択（JSON/Markdown/HTML/Patch）
3. オプションを設定（パス情報含む/コンテキスト行数など）
4. ダウンロードまたはクリップボードにコピー
```

## 5. 制約事項

### 5.1 技術制約
- React 19 + TypeScript
- Cloudflare Workers (Hono)
- Vite ビルドシステム
- ブラウザローカル処理優先

### 5.2 運用制約
- 最大ファイルサイズ: 10MB
- 共有URL有効期限: 7日間
- 履歴保存件数: 最新100件

